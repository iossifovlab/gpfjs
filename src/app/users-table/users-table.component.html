<div class="row">
  <div class="col-12 mt-3">
    <div class="grid-container" *ngIf="users">
      <div class="grid-header">User</div>
      <div class="grid-header">Has password</div>
      <div class="grid-header">Groups</div>
      <div class="grid-header">Datasets</div>
      <div class="grid-header">Actions</div>
      <ng-container *ngFor="let user of users">
        <div class="grid-cell">
          <a>
            <div>
              <span *ngIf="user.name === '' && currentUserEdit !== user.id" id="add-user-name">Add username</span>
              <span *ngIf="user.name !== '' && currentUserEdit !== user.id" id="user-name">{{ user.name }}</span>
              <i
                *ngIf="currentUserEdit !== user.id"
                (click)="currentUserEdit = user.id"
                id="edit-icon"
                class="fa fa-pencil fa-lg"
                title="Edit"></i>
              <div *ngIf="currentUserEdit === user.id" id="edit-wrapper">
                <input
                  #newNameBox
                  type="text"
                  [value]="user.name"
                  class="search-input form-control my-0 py-1"
                  id="name-field"
                  spellcheck="false"
                  autocomplete="off"
                  (keydown.enter)="edit(user, newNameBox.value)" />
                <button id="cancel-button" (click)="currentUserEdit = -1" title="Cancel">
                  <i class="fa fa-thin fa-times" aria-hidden="true"></i
                ></button>
              </div>
            </div>
            <div>{{ user.email }}</div>
          </a>
        </div>

        <div class="grid-cell">
          <span *ngIf="user.hasPassword">
            <i class="fa fa-check" aria-hidden="true"></i>
          </span>
        </div>

        <div class="grid-cell list-cell">
          <div>
            <div class="item-wrapper" *ngFor="let group of user.groups">
              <span class="item" [title]="group">{{ group }}</span>
              <gpf-confirm-button
                (clicked)="removeGroup(user, group)"
                [hide]="isDefaultGroup(user, group) || (user.email === currentUserEmail && group === 'admin')"
                confirmText="Remove"
                title="Remove group"
                message="Remove group?"
                [iconStyle]="['fa', 'fa-thin', 'fa-times']">
              </gpf-confirm-button>
            </div>
          </div>
          <gpf-item-add-menu
            [getItems]="getGroupNamesFunction(user)"
            (addedItem)="addGroup(user, $event)"></gpf-item-add-menu>
        </div>

        <div class="grid-cell list-cell">
          <div>
            <div class="item" [title]="dataset.datasetName" *ngFor="let dataset of user.allowedDatasets">{{ dataset.datasetName }}</div>
          </div>
        </div>

        <div class="grid-cell">
          <span class="action-buttons">
            <gpf-confirm-button
              (clicked)="resetPassword(user)"
              confirmText="Reset"
              title="Reset password"
              [message]="
                user.name +
                ' ' +
                user.email +
                ' password will be reset. An email with reset instructions will be sent and they won&lsquo;t be able to log in until they set a new password.'
              "
              [iconStyle]="['fa', 'fa-lg', 'fa-refresh']">
            </gpf-confirm-button>
            <gpf-confirm-button
              *ngIf="currentUserEmail !== user.email"
              (clicked)="deleteUser(user)"
              confirmText="Delete"
              title="Delete user"
              [message]="user.name + ' ' + user.email + ' will be deleted. This action is irrevertible!'"
              [iconStyle]="['fa', 'fa-lg', 'fa-times']">
            </gpf-confirm-button>
          </span>
        </div>
      </ng-container>
    </div>
  </div>
</div>
