<div style="padding: 25px; padding-top: 16px;">
  <div *ngIf="config" class="table-container">
    <div id="table-top">
      <ng-container *ngTemplateOutlet="aboveTableBar"></ng-container>
      <div id="header" class="table-row">
        <ng-container *ngTemplateOutlet="tableHeaderTemplate; context: { columns: config.columns }"></ng-container>
      </div>
    </div>
    <div id="table-body">
      <div *ngFor="let row of genes; let i = index"
        class="table-row table-body-row"
        [ngClass]="{'row-highlight': highlightedGenes.has(row[geneSymbolColumnId])}">
        <ng-container *ngIf="shownRows.indexOf(i) !== -1">
          <div *ngFor="let column of leaves"
            class="cell row-cell"
            [attr.title]="row[column.id]"
            (click)="handleCellClick($event, row, column)"
            (middleclick)="handleCellClick($event, row, column)">
            <span *ngIf="column.clickable !== null && row[column.id]" class="clickable">{{ row[column.id] }}</span>
            {{ column.clickable === null ? row[column.id] : '' }}
          </div>
        </ng-container>
      </div>

      <div id="nothing-found" [style.grid-template-columns.px]="(leaves.length * 110) + 40" class="table-row table-body-row" [hidden]="!showNothingFound">
        <span>Nothing found</span>
      </div>
    </div>

    <div id="loading" *ngIf="showInitialLoading">
      <span>Loading...</span>
    </div>
  </div>

  <ng-template #tableHeaderTemplate let-columns="columns">
    <ng-container *ngFor="let column of columns">
      <ng-container *ngIf="column.visibility">
        <div class="cell header-cell {{'column-depth-' + column.depth}}"
          [ngClass]="{'active-sort-header': column.id === sortBy}"
          [style.grid-column]="column.gridColumn"
          [style.grid-row]="column.gridRow"
          [style.cursor]="column.sortable ? 'pointer' : 'default'"
          (click)="column.sortable && sort(column.id, column.id === sortBy && orderBy === 'desc' ? 'asc' : 'desc')"
        >
          <div class="header-cell-content"
            [ngClass]="{'header-cell-vertical-content': column.displayVertical}"
          >
            <span
              class="header-cell-content-span"
              [attr.title]="column.meta || column.displayName"
              [ngClass]="{'vertical-text': column.displayVertical, 'header-gene-symbol-span' : column.id === geneSymbolColumnId}"
              >{{ column.displayName | truncate : 48 }}</span
            >
            <gpf-sorting-buttons
              *ngIf="column.sortable"
              [id]="column.id"
              class="header-button sorting-button"
              style="pointer-events: none"
              [hideState]="column.id !== sortBy ? 0 : orderBy === 'asc' ? -1 : 1"
            >
            </gpf-sorting-buttons>
            <button
              *ngIf="column.columns.length"
              #columnFilteringButton
              class="header-button navbar-toggler column-filtering-button"
              (click)="openDropdown(column, $event)"
              title="Filter columns">
              &#9776;
            </button>
          </div>
        </div>
        <ng-container *ngTemplateOutlet="tableHeaderTemplate; context: { columns: column.columns }"></ng-container>
      </ng-container>
    </ng-container>
  </ng-template>

  <ng-template #aboveTableBar>
    <div id="above-table-bar">
      <div style="width: 270px">
        <div class="search-input-wrapper">
          <label for="gene-search-input" class="input-group-prepend" style="align-items: center; padding-left: 10px; height: 38px;">
            <svg style="opacity: 60%;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
          </label>
          <input
            #searchBox
            (keyup)="searchKeystrokes$.next(searchBox.value)"
            id="gene-search-input"
            class="search-input form-control"
            autocomplete="off"
            placeholder="Search gene"
            type="text"
            style="padding-left: 10px"
            spellcheck="false" />
          <span
            *ngIf="searchBox.value !== '' && !showSearchLoading"
            class="search-clear-icon"
            [style.background-image]="'url(' + imgPathPrefix + 'search-clear-icon.png)'"
            (click)="searchBox.value = ''; search(searchBox.value); showSearchLoading = true">
          </span>
          <span
            *ngIf="showSearchLoading"
            class="search-loading-icon"
            [style.background-image]="'url(' + imgPathPrefix + 'load-search-icon.png)'">
          </span>
        </div>
      </div>

      <div class="vertical-line"></div>

      <div class="above-table-bar-item">
        <button
          #columnFilteringButton
          id="category-filtering-button"
          class="btn btn-default"
          (click)="openCategoryFilterDropdown($event)"
          title="Filter categories"
          >&#9776;</button
        >
      </div>

      <div id="keybinds-icon" (mouseover)="showKeybinds = true" (mouseout)="showKeybinds = false">
        <span>?</span>
      </div>

      <div *ngIf="showKeybinds" class="keybinds-tooltip">
        <span>1</span>&#160;<span>2</span>&#160;<span>3</span> - navigate to tab by index<br />
        <span>e</span> or <span>n</span> - navigate to the next tab<br />
        <span>q</span> or <span>p</span> - navigate to the previous tab<br />
        <span>w</span> - close current tab<br />
        <span>middleclick</span> or <span>ctrl</span>/<span>command</span> + <span>click</span> - highlight row<br />
        <span>esc</span> - clear all highlights<br />
        <span>f</span> - compare highlighted genes<br />
      </div>
    </div>
  </ng-template>

  <span #dropdownSpan class="dropdown-span" ngbDropdown [style.top.px]="modalPosition.top" [style.left.px]="modalPosition.left">
    <button ngbDropdownToggle style="display: none"></button>
    <gpf-multiple-select-menu class="multiple-select-menu" ngbDropdownMenu (applyEvent)="calculateHeaderLayout()" (reorderEvent)="reorderHeader($event)">
    </gpf-multiple-select-menu>
  </span>

  <div id="compare-genes-modal" *ngIf="highlightedGenes.size >= 1">
    <div *ngFor="let gene of highlightedGenes"
      class="btn-group"
      style="margin: 4px; background-color: none"
      role="group">
      <button class="compare-gene-item" [attr.title]="gene" type="button">
        <span (middleclick)="emitCreateTabEvent($event, gene, false)" (click)="emitCreateTabEvent($event, gene)" class="compare-genes-gene-name clickable">{{ gene }}</span>
        <button (click)="toggleHighlightGene(gene)" class="compare-genes-close font-weight-light" type="button">Ã—</button>
      </button>
    </div>

    <br>

    <button
      id="compare-genes-compare-button"
      class="btn btn-default"
      (click)="emitCreateTabEvent()"
      title="Compare highlighted genes">Compare</button
    >
  </div>
</div>
