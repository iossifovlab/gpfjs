<div class="container">
  <div class="row variant-report-block form-block mb-3">
      <div class="col-2">
        <label class="form-block-title" for="studies">Study</label>
      </div>

      <div class="col-4">
        <select class="form-control"
          [ngModel]="selectedReport$ | async"
          (ngModelChange)="selectReport($event)">
          <option *ngFor="let study of (reports$ | async)?.studies"
            [ngValue]="study">{{ study.name }}</option>
        </select>
      </div>
  </div>
</div>

<div *ngIf="(variantReport$ | async) as variantReport" class="variants-report-content">
  <div class="row justify-content-center mb-3">
    <div class="col-12">
      <h4 class="text-center" style="margin-bottom: 0;">{{ variantReport.studyName }}</h4>
    </div>
    <div class="col-12">
      <h4 class="text-center"><small class="text-muted">{{ variantReport.studyDescription }}</small></h4>
    </div>

    <div class="col-12 mb-1">
      <h5>Total number of families: {{ variantReport.familyReport.familiesTotal }} <span *ngIf="variantReport.isDownloadable">(<a [href]="getDownloadLink(variantReport)" download>Download</a>)</span></h5>
    </div>
  </div>

  <ng-template ngFor let-peopleCounter [ngForOf]="variantReport.familyReport.peopleCounters">
    <div class="row mb-3">
      <div class="col-12 mb-1">
        <h5>Families by number of {{ peopleCounter.roles.join('/') }} roles</h5>
      </div>

      <div class="col-12">
        <table class="table table-bordered table-hover table-sm table-centered">
          <thead>
            <th>Phenotype</th>
            <th *ngFor="let column of peopleCounter.phenotypes">
              {{ column }}
            </th>
          </thead>
          <tbody>
            <tr>
              <th>Male</th>
              <td *ngFor="let childrenCounter of orderByColumnOrder(peopleCounter.childrenCounters, peopleCounter.phenotypes)">
                {{ childrenCounter.childrenMale }}
              </td>
            </tr>

            <tr>
              <th>Female</th>
              <td *ngFor="let childrenCounter of orderByColumnOrder(peopleCounter.childrenCounters, peopleCounter.phenotypes)">
                {{ childrenCounter.childrenFemale }}
              </td>
            </tr>

            <tr>
              <th>Unspecified</th>
              <td *ngFor="let childrenCounter of orderByColumnOrder(peopleCounter.childrenCounters, peopleCounter.phenotypes)">
                {{ childrenCounter.childrenUnspecified }}
              </td>
            </tr>

            <tr>
              <th>Total</th>
              <td *ngFor="let childrenCounter of orderByColumnOrder(peopleCounter.childrenCounters, peopleCounter.phenotypes)">
                {{ childrenCounter.childrenTotal }}
              </td>
            </tr>

          </tbody>
        </table>
      </div>
    </div>
  </ng-template>


  <ng-template ngFor let-pedigreeGroups [ngForOf]="pedigreeTables">
    <div class="row mb-3">
      <div class="col-12 mb-1"><h5>Families by pedigree of {{ pedigreeGroups.phenotypes.join('/') }} phenotypes</h5></div>

      <div class="col-12">

        <table class="table table-bordered table-hover table-sm table-centered">
          <colgroup>
            <col />
            <col />
            <col />
            <col />
          </colgroup>

          <tbody>
            <ng-template ngFor let-pedigreeGroup [ngForOf]="pedigreeGroups.pedigrees">
              <tr>
                <ng-template ngFor let-pedigree [ngForOf]="pedigreeGroup">
                  <td class="centered">
                    <div *ngIf="pedigree">
                      <div>
                        <gpf-pedigree-chart [family]="pedigree.data"></gpf-pedigree-chart>
                      </div>
                      <div>
                        {{ pedigree.count }}
                      </div>
                    </div>
                  </td>
                </ng-template>
              </tr>
            </ng-template>
          </tbody>

        </table>

      </div>
    </div>
  </ng-template>

  <div *ngIf="variantReport.denovoReport" class="row mb-3">
    <ng-template ngFor let-table [ngForOf]="variantReport.denovoReport.tables">
      <div class="col-12 mb-1">
        <h5>De Novo Variants of {{ table.roles.join('/') }} roles</h5>
        <h5><small class="text-muted">Legend: "number of observed events", "observed rate per child" ("number of children with events", "percent of children with events")</small></h5>
      </div>
      <div class="col-12">
        <table class="table table-bordered table-hover table-sm table-centered">
          <thead>
            <th>Phenotype</th>
            <th *ngFor="let column of table.phenotypes">
              {{ column }}
            </th>
          </thead>
          <tbody>
            <tr
              *ngFor="let effectType of getRows(variantReport.denovoReport.effectGroups, variantReport.denovoReport.effectTypes)"
              [ngClass]="{ 'table-active' : (variantReport.denovoReport.effectGroups.indexOf(effectType) !== -1) }">
              <th>{{ effectType }}</th>
              <td *ngFor="let effectTypeData of getEffectTypeOrderByColumOrder(effectType, table, table.phenotypes)">
                <div>
                  {{ effectTypeData.eventsCount }}, {{ effectTypeData.eventsRatePerChild }}
                </div>
                <div>
                  ({{ effectTypeData.eventsChildrenCount }}, {{ effectTypeData.eventsChildrenPercent | percent }})
                </div>
              </td>
            </tr>

          </tbody>
        </table>
      </div>
    </ng-template>
  </div>
</div>
