<ng-template #pedigree>
  <div class="toggle-maximize" (click)="toggleMaximize()"></div>
  <div
    #wrapper
    class="svg-wrapper clickable"
    style="display: flex; width: 100%; height: 100%"
    data-toggle="modal"
    attr.data-target="#{{ pedigreeModalId }}">
    <svg [attr.width]="width" [attr.viewBox]="getViewBox()" [ngClass]="{ 'fullscreen-pedigree': maximized }">
      <svg:line
        *ngFor="let straightLine of straightLines"
        [attr.x1]="straightLine.startX"
        [attr.y1]="straightLine.startY"
        [attr.x2]="straightLine.endX"
        [attr.y2]="straightLine.endY"
        stroke="black"
        stroke-width="1" />

      <svg:path
        *ngFor="let curveLine of curveLines"
        [attr.d]="curveLine.path"
        fill="none"
        stroke="black"
        stroke-width="1" />

      <svg:g
        gpf-pedigree-chart-member
        *ngFor="let pedigree of pedigreeDataWithLayout"
        [attr.transform]="
          'translate(' +
          pedigree.xUpperLeftCorner +
          ' ' +
          pedigree.yUpperLeftCorner +
          ') scale(' +
          pedigree.scaleFactor +
          ')'
        "
        [pedigreeData]="pedigree.individual.pedigreeData" />
    </svg>
  </div>
</ng-template>

<div class="modal fade" id="{{ pedigreeModalId }}">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div style="padding: 5px" class="modal-content">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span style="float: right; margin-right: 10px" aria-hidden="true">&times;</span>
      </button>
      <div style="padding: 0 0 15px 0">
        <ng-container *ngTemplateOutlet="pedigree"></ng-container>
      </div>
      <ngb-accordion *ngIf="counterId !== undefined" #a="ngbAccordion">
        <ngb-panel>
          <ng-template ngbPanelHeader>
            <div style="text-align: left">
              <button
                ngbPanelToggle
                (click)="loadFamilyListData()"
                type="button"
                class="btn btn-md btn-secondary btn-left">Family Id list ({{ pedigreeCount }})</button>
              <form
                (ngSubmit)="onSubmit($event)"
                action="{{ configService.baseUrl }}common_reports/family_counters/download"
                method="post">
                <input name="queryData" type="hidden" />
                <button
                  class="btn btn-md btn-primary btn-right"
                  id="download-button"
                  type="submit"
                  style="position: absolute; right: 5px; top: 105px">Download</button>
              </form>
            </div>
          </ng-template>
          <ng-template ngbPanelContent>
            <div class="family-panel">
              <gpf-loading-spinner
                *ngIf="!loadingFinishedFlag"
                [loadingFinished]="loadingFinishedFlag"></gpf-loading-spinner>
              <ng-container *ngIf="familyLists">{{ familyLists | join: ', ' }}</ng-container>
            </div>
          </ng-template>
        </ngb-panel>
      </ngb-accordion>
    </div>
  </div>
</div>

<div *ngIf="!maximized">
  <ng-container *ngTemplateOutlet="pedigree"></ng-container>
</div>
