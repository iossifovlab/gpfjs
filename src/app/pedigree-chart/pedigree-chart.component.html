<ng-template #pedigree>
  <svg [ngStyle]="{'cursor': modalService.hasOpenModals() ? 'default' : 'pointer'}" [attr.viewBox]="getViewBox()">
    <svg:line
      *ngFor="let straightLine of straightLines"
      [attr.x1]="straightLine.startX"
      [attr.y1]="straightLine.startY"
      [attr.x2]="straightLine.endX"
      [attr.y2]="straightLine.endY"
      stroke="black"
      stroke-width="1" />

    <svg:path
      *ngFor="let curveLine of curveLines"
      [attr.d]="curveLine.path"
      fill="none"
      stroke="black"
      stroke-width="1" />

    <svg:g
      gpf-pedigree-chart-member
      *ngFor="let pedigree of pedigreeDataWithLayout"
      [attr.transform]="
        'translate(' +
        pedigree.xUpperLeftCorner +
        ' ' +
        pedigree.yUpperLeftCorner +
        ') scale(' +
        pedigree.scaleFactor +
        ')'
      "
      [pedigreeData]="pedigree.individual.pedigreeData" />
  </svg>
</ng-template>

<ng-template #pedigreeModal let-modal>
  <button (click)="closeModal()" type="button" style="margin-left: 95%;" class="btn-close"></button>
  <div class="svg-container" style="max-width: 200px">
    <ng-container *ngTemplateOutlet="pedigree"></ng-container>
  </div>
  <ngb-accordion style="margin-top: 10px;" *ngIf="counterId !== undefined" #a="ngbAccordion">
    <ngb-panel>
      <ng-template ngbPanelHeader>
        <div style="text-align: left; display: flex; justify-content: space-between;">
          <button
            ngbPanelToggle
            (click)="loadFamilyListData()"
            type="button"
            class="btn btn-secondary btn-left">Family Id list ({{ pedigreeCount }})</button>
          <form
            (ngSubmit)="onSubmit($event)"
            action="{{ configService.baseUrl }}common_reports/family_counters/download"
            method="post">
            <input name="queryData" type="hidden" />
            <button
              class="btn btn-md btn-primary btn-right"
              id="download-button"
              type="button submit">Download</button>
          </form>
        </div>
      </ng-template>
      <ng-template ngbPanelContent>
        <div class="family-panel">
          <gpf-loading-spinner
            *ngIf="!loadingFinishedFlag"
            [loadingFinished]="loadingFinishedFlag"></gpf-loading-spinner>
          <ng-container *ngIf="familyLists">{{ familyLists | join: ', ' }}</ng-container>
        </div>
      </ng-template>
    </ngb-panel>
  </ngb-accordion>
</ng-template>

<div
  [ngbPopover]="pedigreeModal"
  [autoClose]="'outside'"
  [animation]="false"
  container="body"
  placement="right left"
  class="svg-container"
  style="width: 50%; max-width: 100px;"
>
  <ng-container *ngTemplateOutlet="pedigree"></ng-container>
</div>
